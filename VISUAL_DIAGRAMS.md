# ğŸ“Š VISUAL DIAGRAMS & FLOWCHARTS

## 1. System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AGROBUILD SYSTEM                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend Layer (React)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  AdminCreateProduct.tsx                                 â”‚
â”‚  â”œâ”€ Product Form                                        â”‚
â”‚  â”‚  â”œâ”€ product_id, title, price, mrp                   â”‚
â”‚  â”‚  â”œâ”€ category, brand, stock                          â”‚
â”‚  â”‚  â””â”€ description, features, technical info           â”‚
â”‚  â”œâ”€ Image Upload                                        â”‚
â”‚  â”‚  â”œâ”€ Upload to Supabase Storage                       â”‚
â”‚  â”‚  â”œâ”€ Get public URLs                                  â”‚
â”‚  â”‚  â””â”€ Store in images array                            â”‚
â”‚  â””â”€ SKU Management                                      â”‚
â”‚     â”œâ”€ Add Variant Button                               â”‚
â”‚     â”œâ”€ Unit Type (Litre/Kg)                             â”‚
â”‚     â”œâ”€ Quantity (500ml, 1L, etc)                        â”‚
â”‚     â”œâ”€ Pieces per Box (6, 8, 10, 12)                    â”‚
â”‚     â”œâ”€ Unit & Box Pricing                               â”‚
â”‚     â””â”€ Delete Variant Button                            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ POST /api/admin/products
                     â”‚ {
                     â”‚   product fields,
                     â”‚   images: [url1, url2],
                     â”‚   sku_variants: [{...}]
                     â”‚ }
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API Layer (Express.js)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  server/routes/admin/products.ts                        â”‚
â”‚  POST /api/admin/products                               â”‚
â”‚  PUT /api/admin/products/:id                            â”‚
â”‚  DELETE /api/admin/products/:id                         â”‚
â”‚                                                          â”‚
â”‚  server/routes/products.ts                              â”‚
â”‚  GET /api/products (with skus)                          â”‚
â”‚  GET /api/products/:id (with skus)                      â”‚
â”‚  GET /api/products/by-product-id/:id (with skus)        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Calls admin functions
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Database Layer (server/lib/db/admin.ts)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  adminCreateProduct(payload)                            â”‚
â”‚  â”œâ”€ Extract sku_variants                                â”‚
â”‚  â”œâ”€ Insert product â†’ products table                     â”‚
â”‚  â”œâ”€ Get returned product.id                             â”‚
â”‚  â””â”€ Insert skus â†’ product_skus table                    â”‚
â”‚                                                          â”‚
â”‚  adminUpdateProduct(id, payload)                        â”‚
â”‚  â”œâ”€ Update product â†’ products table                     â”‚
â”‚  â”œâ”€ Delete old skus                                     â”‚
â”‚  â””â”€ Insert new skus â†’ product_skus table                â”‚
â”‚                                                          â”‚
â”‚  adminDeleteProduct(id)                                 â”‚
â”‚  â””â”€ Delete product (cascade â†’ deletes skus)             â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Supabase Client
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PostgreSQL Database (Supabase)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚     PRODUCTS TABLE       â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  â”‚ id (PK)                  â”‚                           â”‚
â”‚  â”‚ product_id (UNIQUE)      â”‚                           â”‚
â”‚  â”‚ title                    â”‚                           â”‚
â”‚  â”‚ price, mrp, discount     â”‚                           â”‚
â”‚  â”‚ category_name            â”‚                           â”‚
â”‚  â”‚ brand, description       â”‚                           â”‚
â”‚  â”‚ images (TEXT[])          â”‚â—„â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ image_count (INT)        â”‚     â”‚ Auto-managed        â”‚
â”‚  â”‚ primary_image (TEXT)     â”‚     â”‚ by trigger          â”‚
â”‚  â”‚ stock_quantity           â”‚â—„â”€â”€â”€â”€â”˜                     â”‚
â”‚  â”‚ gst_percentage           â”‚                           â”‚
â”‚  â”‚ availability             â”‚                           â”‚
â”‚  â”‚ created_at               â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚               â”‚ FK (id)                                 â”‚
â”‚               â”‚ ON DELETE CASCADE                       â”‚
â”‚               â”‚                                         â”‚
â”‚               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  PRODUCT_SKUS TABLE      â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  â”‚ id (PK)                  â”‚                           â”‚
â”‚  â”‚ product_id (FK)          â”‚                           â”‚
â”‚  â”‚ unit_type (CHK)          â”‚ ('Litre' or 'Kg')         â”‚
â”‚  â”‚ quantity (VARCHAR)       â”‚ ('500ml', '1L', etc)      â”‚
â”‚  â”‚ pieces_per_box (CHK)     â”‚ (6, 8, 10, 12)            â”‚
â”‚  â”‚ unit_price               â”‚                           â”‚
â”‚  â”‚ unit_mrp                 â”‚                           â”‚
â”‚  â”‚ box_price                â”‚                           â”‚
â”‚  â”‚ box_mrp                  â”‚                           â”‚
â”‚  â”‚ created_at, updated_at   â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                          â”‚
â”‚  Trigger: update_product_image_count()                  â”‚
â”‚  â”œâ”€ Fires BEFORE INSERT/UPDATE of images               â”‚
â”‚  â”œâ”€ Calculates image_count from array length            â”‚
â”‚  â””â”€ Sets primary_image to first array element           â”‚
â”‚                                                          â”‚
â”‚  Indexes:                                               â”‚
â”‚  â”œâ”€ idx_products_images (GIN on images)                 â”‚
â”‚  â”œâ”€ idx_product_skus_product_id                         â”‚
â”‚  â””â”€ idx_product_skus_unit_type                          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Storage Layer (Supabase Storage)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Bucket: "products"                                     â”‚
â”‚  â”œâ”€ product1/image1.jpg                                 â”‚
â”‚  â”œâ”€ product1/image2.jpg                                 â”‚
â”‚  â”œâ”€ product2/image1.jpg                                 â”‚
â”‚  â””â”€ etc...                                              â”‚
â”‚                                                          â”‚
â”‚  Returns public URLs stored in images array             â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Product Creation Flow

```
START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User opens Admin Create Product     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fill Product Basic Info             â”‚
â”‚ - product_id                        â”‚
â”‚ - title                             â”‚
â”‚ - price, mrp                        â”‚
â”‚ - category_name                     â”‚
â”‚ - stock_quantity                    â”‚
â”‚ - Other fields...                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload Images                       â”‚
â”‚ - Browse files                      â”‚
â”‚ - Upload to Supabase Storage        â”‚
â”‚ - Get public URLs                   â”‚
â”‚ - Add to images array: [url1, url2] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add SKU Variants (Optional)         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Click "Add SKU Variant"         â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Unit Type: [Litre â–¼] or [Kg â–¼] â”‚ â”‚
â”‚ â”‚ Quantity: [500ml â–¼]             â”‚ â”‚
â”‚ â”‚ Pieces/Box: [6 â–¼]               â”‚ â”‚
â”‚ â”‚ Unit Price: [150]               â”‚ â”‚
â”‚ â”‚ Unit MRP: [200]                 â”‚ â”‚
â”‚ â”‚ Box Price: [auto: 900]          â”‚ â”‚
â”‚ â”‚ Box MRP: [auto: 1200]           â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ [Add Variant] [Delete]          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Add multiple variants (repeat)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate Form                       â”‚
â”‚ âœ“ Required fields filled            â”‚
â”‚ âœ“ Images array not empty            â”‚
â”‚ âœ“ SKU constraints (if provided)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
    âŒ INVALID    âœ… VALID
        â”‚             â”‚
        â–¼             â–¼
    Show Error    Prepare Payload
                      â”‚
                      â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Create Payload:     â”‚
                â”‚ {                   â”‚
                â”‚  product_id: "...", â”‚
                â”‚  title: "...",      â”‚
                â”‚  price: 200,        â”‚
                â”‚  images: [url1,...],â”‚
                â”‚  sku_variants: [    â”‚
                â”‚    {                â”‚
                â”‚     unitType:"L",   â”‚
                â”‚     quantity:"500ml",
                â”‚     piecesPerBox:6, â”‚
                â”‚     price:150,      â”‚
                â”‚     mrp:200,        â”‚
                â”‚     boxPrice:900,   â”‚
                â”‚     boxMrp:1200     â”‚
                â”‚    },               â”‚
                â”‚    {...more...}     â”‚
                â”‚  ]                  â”‚
                â”‚ }                   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ POST /api/admin/products
                â”‚ Content-Type: application/json
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼ (Network)
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ adminCreateProduct(payload)  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                     â–¼
            Separate payload      Map SKU fields
            Extract sku_variants  unitTypeâ†’unit_type
            Rest â†’ productData    piecesPerBoxâ†’pieces_per_box
                    â”‚                     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Insert into products table   â”‚
            â”‚ (images array included)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Trigger: update_product_image_count()
        â”‚ Fires BEFORE INSERT                â”‚
        â”‚ â”œâ”€ NEW.image_count = 2             â”‚
        â”‚ â””â”€ NEW.primary_image = url1        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Row saved with:                  â”‚
        â”‚ - id: uuid (generated)           â”‚
        â”‚ - images: [url1, url2]           â”‚
        â”‚ - image_count: 2 (calculated)    â”‚
        â”‚ - primary_image: url1 (set)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ sku_variants array has    â”‚
         â”‚ items? (> 0)              â”‚
         â”‚                           â”‚
    NO  â”‚    YES
        â–¼      â–¼
    Skip   Loop through
    SKU    sku_variants
    Insert â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ For each SKU variant:        â”‚
    â”‚ Build SKU object:            â”‚
    â”‚ {                            â”‚
    â”‚  product_id: product.id,     â”‚
    â”‚  unit_type: "Litre",         â”‚
    â”‚  quantity: "500ml",          â”‚
    â”‚  pieces_per_box: 6,          â”‚
    â”‚  unit_price: 150,            â”‚
    â”‚  unit_mrp: 200,              â”‚
    â”‚  box_price: 900,             â”‚
    â”‚  box_mrp: 1200               â”‚
    â”‚ }                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Insert into product_skus     â”‚
    â”‚ with product_id FK           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ More variants?    â”‚
         â”‚                   â”‚
    YES  â”‚    NO
        â”‚      â–¼
        â””â”€â†’ All SKUs inserted
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Return created product       â”‚
    â”‚ (without skus in response)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ (Network)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Frontend receives:       â”‚
        â”‚ {                        â”‚
        â”‚  success: true,          â”‚
        â”‚  data: {                 â”‚
        â”‚    product: {            â”‚
        â”‚      id: "uuid",         â”‚
        â”‚      product_id: "...",  â”‚
        â”‚      ...                 â”‚
        â”‚    }                     â”‚
        â”‚  }                       â”‚
        â”‚ }                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Show Success Message â”‚
            â”‚ Redirect to Products â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
                    SUCCESS
                      END
```

---

## 3. Get Product with SKUs Flow

```
START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: GET /api/products/{id}    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Route: GET /:id              â”‚
â”‚ (server/routes/products.ts)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Query:                                         â”‚
â”‚ .from("products")                                       â”‚
â”‚ .select(                                                â”‚
â”‚   "*, category:categories(*),                           â”‚
â”‚    variants:product_variants(*),                        â”‚
â”‚    skus:product_skus(*)"                                â”‚
â”‚ )                                                       â”‚
â”‚ .eq("id", id)                                           â”‚
â”‚ .single()                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
        â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ FROM        â”‚    â”‚ JOIN product_skusâ”‚
    â”‚ products p  â”‚    â”‚ WHERE            â”‚
    â”‚ WHERE       â”‚    â”‚ product_id = id  â”‚
    â”‚ p.id = id   â”‚    â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚
           â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Result Set:                        â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚ PRODUCT ROW                  â”‚  â”‚
    â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚ â”‚ id: "abc123"                 â”‚  â”‚
    â”‚ â”‚ product_id: "PROD-001"       â”‚  â”‚
    â”‚ â”‚ title: "Mustard Oil"         â”‚  â”‚
    â”‚ â”‚ images: [url1, url2]         â”‚  â”‚
    â”‚ â”‚ image_count: 2               â”‚  â”‚
    â”‚ â”‚ primary_image: url1          â”‚  â”‚
    â”‚ â”‚ price: 200                   â”‚  â”‚
    â”‚ â”‚ mrp: 350                     â”‚  â”‚
    â”‚ â”‚ ...other fields...           â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                    â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚ SKUs ARRAY (skus property)   â”‚  â”‚
    â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚ â”‚ [                            â”‚  â”‚
    â”‚ â”‚   {                          â”‚  â”‚
    â”‚ â”‚     id: "sku1",              â”‚  â”‚
    â”‚ â”‚     product_id: "abc123",    â”‚  â”‚
    â”‚ â”‚     unit_type: "Litre",      â”‚  â”‚
    â”‚ â”‚     quantity: "500ml",       â”‚  â”‚
    â”‚ â”‚     pieces_per_box: 6,       â”‚  â”‚
    â”‚ â”‚     unit_price: 150,         â”‚  â”‚
    â”‚ â”‚     unit_mrp: 200,           â”‚  â”‚
    â”‚ â”‚     box_price: 900,          â”‚  â”‚
    â”‚ â”‚     box_mrp: 1200            â”‚  â”‚
    â”‚ â”‚   },                         â”‚  â”‚
    â”‚ â”‚   {                          â”‚  â”‚
    â”‚ â”‚     id: "sku2",              â”‚  â”‚
    â”‚ â”‚     product_id: "abc123",    â”‚  â”‚
    â”‚ â”‚     unit_type: "Litre",      â”‚  â”‚
    â”‚ â”‚     quantity: "1L",          â”‚  â”‚
    â”‚ â”‚     pieces_per_box: 6,       â”‚  â”‚
    â”‚ â”‚     unit_price: 280,         â”‚  â”‚
    â”‚ â”‚     unit_mrp: 350,           â”‚  â”‚
    â”‚ â”‚     box_price: 1680,         â”‚  â”‚
    â”‚ â”‚     box_mrp: 2100            â”‚  â”‚
    â”‚ â”‚   }                          â”‚  â”‚
    â”‚ â”‚ ]                            â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                    â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚ CATEGORY (nested relation)   â”‚  â”‚
    â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚ â”‚ id: "cat1"                   â”‚  â”‚
    â”‚ â”‚ name: "Oils"                 â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Normalize Product Row            â”‚
    â”‚ (normalizeProductRow function)   â”‚
    â”‚ - Format images                  â”‚
    â”‚ - Ensure consistency             â”‚
    â”‚ - Handle null values             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Return API Response              â”‚
    â”‚ {                                â”‚
    â”‚   success: true,                 â”‚
    â”‚   data: {                        â”‚
    â”‚     product: {                   â”‚
    â”‚       id: "abc123",              â”‚
    â”‚       product_id: "PROD-001",    â”‚
    â”‚       title: "Mustard Oil",      â”‚
    â”‚       images: [...],             â”‚
    â”‚       image_count: 2,            â”‚
    â”‚       primary_image: url1,       â”‚
    â”‚       skus: [                    â”‚
    â”‚         {                        â”‚
    â”‚           unit_type: "Litre",    â”‚
    â”‚           quantity: "500ml",     â”‚
    â”‚           unit_price: 150,       â”‚
    â”‚           box_price: 900         â”‚
    â”‚         },                       â”‚
    â”‚         {...}                    â”‚
    â”‚       ]                          â”‚
    â”‚     }                            â”‚
    â”‚   }                              â”‚
    â”‚ }                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ (Network)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Frontend receives data           â”‚
    â”‚ Product ready to display         â”‚
    â”‚ SKUs ready for variant selector  â”‚
    â”‚ Images ready for gallery         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Render ProductDetail Page:       â”‚
    â”‚ - Show title, price, images      â”‚
    â”‚ - Display image gallery          â”‚
    â”‚ - Show SKU selector              â”‚
    â”‚ - Display variant prices         â”‚
    â”‚ - Add to cart button             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
      SUCCESS
        END
```

---

## 4. Image Trigger Execution

```
Data Insertion/Update
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSERT/UPDATE products  â”‚
â”‚ SET images = [url1,url2]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trigger: trigger_update_product_image_count  â”‚
â”‚ BEFORE INSERT OR UPDATE OF images            â”‚
â”‚ FOR EACH ROW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Function: update_product_image_count()       â”‚
â”‚                                              â”‚
â”‚ BEGIN                                        â”‚
â”‚   -- Step 1: Calculate image count           â”‚
â”‚   NEW.image_count :=                         â”‚
â”‚     COALESCE(array_length(NEW.images, 1), 0)â”‚
â”‚   â”‚                                          â”‚
â”‚   â”‚ If images = [url1, url2]                 â”‚
â”‚   â”‚ â†’ image_count = 2                        â”‚
â”‚   â”‚                                          â”‚
â”‚   â”‚ If images = NULL or []                   â”‚
â”‚   â”‚ â†’ image_count = 0                        â”‚
â”‚   â”‚                                          â”‚
â”‚   â–¼                                          â”‚
â”‚   -- Step 2: Set primary image               â”‚
â”‚   NEW.primary_image :=                       â”‚
â”‚     COALESCE(NEW.images[1], NULL)            â”‚
â”‚   â”‚                                          â”‚
â”‚   â”‚ If images[1] exists                      â”‚
â”‚   â”‚ â†’ primary_image = url1                   â”‚
â”‚   â”‚                                          â”‚
â”‚   â”‚ If images is empty                       â”‚
â”‚   â”‚ â†’ primary_image = NULL                   â”‚
â”‚   â”‚                                          â”‚
â”‚   â–¼                                          â”‚
â”‚   -- Step 3: Return modified row             â”‚
â”‚   RETURN NEW;                                â”‚
â”‚ END;                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Row Ready for INSERT/UPDATE                  â”‚
â”‚ - image_count calculated                     â”‚
â”‚ - primary_image set                          â”‚
â”‚ - All other fields unchanged                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSERT/UPDATE completes                      â”‚
â”‚ Row saved to products table with:            â”‚
â”‚ - images: [url1, url2]                       â”‚
â”‚ - image_count: 2                             â”‚
â”‚ - primary_image: url1                        â”‚
â”‚ - all other product fields                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
     SUCCESS
```

---

## 5. Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PRODUCTS     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ product_id (U)   â”‚         â”‚
â”‚ title            â”‚         â”‚
â”‚ price, mrp       â”‚         â”‚
â”‚ images (TEXT[])  â”‚         â”‚
â”‚ image_count      â”‚         â”‚ ONE
â”‚ primary_image    â”‚         â”‚ TO
â”‚ ...              â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ MANY
         â–²                    â”‚
         â”‚                    â”‚
         â”‚ (FK)               â”‚
         â”‚ ON DELETE          â”‚
         â”‚ CASCADE            â”‚
         â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PRODUCT_SKUS                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                            â”‚
â”‚ product_id (FK)                    â”‚
â”‚ unit_type (Litre | Kg) [CHK]       â”‚
â”‚ quantity (500ml, 1L, etc)          â”‚
â”‚ pieces_per_box (6|8|10|12) [CHK]   â”‚
â”‚ unit_price, unit_mrp               â”‚
â”‚ box_price, box_mrp                 â”‚
â”‚ created_at, updated_at             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relationship:
- 1 Product â†’ âˆ SKU Variants
- When Product deleted â†’ SKU Variants auto-deleted (CASCADE)
- Each SKU variant belongs to exactly 1 product
```

---

## 6. Request/Response Cycle

```
Frontend (React Component)
    â”‚
    â”‚ User fills form & clicks "Create"
    â”‚
    â–¼
Prepare Payload:
{
  product_id: "PROD-001",
  title: "Oil",
  price: 200,
  mrp: 350,
  images: ["https://..."],
  sku_variants: [
    {
      unitType: "Litre",
      quantity: "500ml",
      piecesPerBox: 6,
      price: 150,
      mrp: 200,
      boxPrice: 900,
      boxMrp: 1200
    }
  ]
}
    â”‚
    â–¼
POST /api/admin/products
(Network Request)
    â”‚
    â–¼
Express Router:
  server/routes/admin/products.ts
  POST / handler
    â”‚
    â–¼
Calls: adminCreateProduct(req.body)
    â”‚
    â–¼
adminCreateProduct():
  1. Destructure: { sku_variants, ...productData }
  2. supabase.from("products").insert(productData)
       â”œâ”€ image_count trigger fires
       â”œâ”€ primary_image trigger fires
       â””â”€ â†’ product inserted
  3. Map SKU fields: unitType â†’ unit_type
  4. supabase.from("product_skus").insert(skusArray)
       â””â”€ â†’ skus inserted (linked via product_id)
  5. return product
    â”‚
    â–¼
Database:
  INSERT products (image_count, primary_image auto-calc)
  INSERT product_skus (with product_id FK)
    â”‚
    â–¼
Return Response:
{
  success: true,
  data: {
    product: {
      id: "uuid",
      product_id: "PROD-001",
      ...
    }
  }
}
    â”‚
    â–¼
Frontend:
  Handle response
  Show success message
  Redirect to products list
    â”‚
    â–¼
User sees new product in list
```

---

## 7. SKU Variant Pricing Calculation

```
User Input:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Unit Type: Litre       â”‚
â”‚ Quantity: 500ml        â”‚
â”‚ Pieces per Box: 6      â”‚
â”‚ Unit Price: 150        â”‚ â† User enters
â”‚ Unit MRP: 200          â”‚ â† User enters
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Frontend Auto-Calculate:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Box Price:             â”‚
â”‚ = Unit Price Ã— Pieces  â”‚
â”‚ = 150 Ã— 6              â”‚
â”‚ = 900                  â”‚ â† Auto-filled
â”‚                        â”‚
â”‚ Box MRP:               â”‚
â”‚ = Unit MRP Ã— Pieces    â”‚
â”‚ = 200 Ã— 6              â”‚
â”‚ = 1200                 â”‚ â† Auto-filled
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Form Display:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Unit Price: 150        â”‚
â”‚ Unit MRP: 200          â”‚
â”‚ Box Price: 900         â”‚
â”‚ Box MRP: 1200          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Backend Receives:
{
  unitType: "Litre",
  quantity: "500ml",
  piecesPerBox: 6,
  price: 150,
  mrp: 200,
  boxPrice: 900,
  boxMrp: 1200
}
        â”‚
        â–¼
Mapped to Database Fields:
{
  unit_type: "Litre",
  quantity: "500ml",
  pieces_per_box: 6,
  unit_price: 150,
  unit_mrp: 200,
  box_price: 900,
  box_mrp: 1200
}
        â”‚
        â–¼
Stored in product_skus Table
```

This diagram shows how the system handles everything from data input through calculation and storage!
